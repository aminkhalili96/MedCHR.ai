{% extends "base.html" %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
    <div>
        <h1 style="margin: 0;">Admin Dashboard</h1>
        <p class="muted" style="margin: 4px 0 0 0;">Manage users and tenant settings</p>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Add New User</h3>
    </div>
    <form method="post" action="/ui/admin/users">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <div class="grid">
            <div>
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" placeholder="colleague@example.com" required />
            </div>
            <div>
                <label for="password">Initial Password</label>
                <input type="password" id="password" name="password" required />
            </div>
        </div>
        <div class="mt-md">
            <label for="role">Role</label>
            <select id="role" name="role" style="
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 15px;
            color: var(--text-primary);
            background: var(--bg-secondary);
          ">
                <option value="clinician">Clinician</option>
                <option value="admin">Admin</option>
            </select>
        </div>
        <div class="mt-md">
            <button type="submit">+ Create User</button>
        </div>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Users</h3>
        <span class="badge badge-neutral">{{ users | length }} users</span>
    </div>
    {% if users %}
    <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
        <thead>
            <tr style="text-align: left; border-bottom: 1px solid var(--border-light);">
                <th style="padding: 12px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">User</th>
                <th style="padding: 12px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">Role</th>
                <th style="padding: 12px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">Joined</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr style="border-bottom: 1px solid var(--border-light);">
                <td style="padding: 12px;">
                    <div style="font-weight: 500;">{{ u.email }}</div>
                </td>
                <td style="padding: 12px;">
                    <span class="badge {{ 'badge-neutral' if u.role == 'admin' else 'badge-success' }}">
                        {{ u.role | title }}
                    </span>
                </td>
                <td style="padding: 12px; color: var(--text-muted); font-size: 13px;">
                    {{ u.created_at.strftime('%Y-%m-%d') }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="empty-state-icon">ðŸ‘¥</div>
        <p>No users found</p>
    </div>
    {% endif %}
</div>

<div class="card">
    <div class="card-header">
        <h3 class="card-title">Tenant IP Allowlist</h3>
    </div>
    <p class="muted" style="margin-top: 0;">
        One IP or CIDR per line. Leave empty to allow all source IPs.
    </p>
    {% if allowlist_error %}
    <div class="alert alert-danger" style="margin-bottom: 12px;">{{ allowlist_error }}</div>
    {% endif %}
    <form method="post" action="/ui/admin/ip-allowlist">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <label for="ip_whitelist">Allowed IPs / CIDRs</label>
        <textarea
            id="ip_whitelist"
            name="ip_whitelist"
            rows="6"
            placeholder="203.0.113.10&#10;198.51.100.0/24"
            style="width: 100%;"
        >{{ ip_whitelist_text or '' }}</textarea>
        <div class="mt-md">
            <button type="submit">Save Allowlist</button>
        </div>
    </form>
</div>
{% endblock %}
